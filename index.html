<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INTUITY - Sentence Sequencing</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'DM Sans', 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: #0d0d0d;
      color: white;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }

    .background {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(201, 169, 97, 0.18) 0%, transparent 40%),
                  radial-gradient(circle at 70% 80%, rgba(201, 169, 97, 0.16) 0%, transparent 38%),
                  radial-gradient(circle at 20% 70%, rgba(201, 169, 97, 0.12) 0%, transparent 45%),
                  radial-gradient(circle at 85% 15%, rgba(201, 169, 97, 0.14) 0%, transparent 35%),
                  #0d0d0d;
      z-index: 0;
      overflow: hidden;
    }

    .elegant-curves {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
    }

    .curve-elegant {
      position: absolute;
      border-radius: 50%;
      filter: blur(2px);
    }

    .curve-elegant-1 {
      width: 500px;
      height: 900px;
      top: -300px;
      right: -150px;
      border: 3px solid rgba(201, 169, 97, 0.35);
      background: linear-gradient(135deg, 
        rgba(201, 169, 97, 0.15) 0%, 
        rgba(201, 169, 97, 0.08) 50%, 
        transparent 100%);
      transform: rotate(25deg);
      animation: floatElegant 12s ease-in-out infinite;
      box-shadow: 
        inset 0 0 60px rgba(201, 169, 97, 0.1),
        0 0 80px rgba(201, 169, 97, 0.15);
    }

    .curve-elegant-2 {
      width: 600px;
      height: 1100px;
      bottom: -400px;
      left: -200px;
      border: 2.5px solid rgba(201, 169, 97, 0.32);
      background: linear-gradient(135deg, 
        rgba(201, 169, 97, 0.12) 0%, 
        rgba(201, 169, 97, 0.06) 40%,
        transparent 80%);
      transform: rotate(-20deg);
      animation: floatElegant 15s ease-in-out infinite reverse;
      box-shadow: 
        inset 0 0 50px rgba(201, 169, 97, 0.08),
        0 0 70px rgba(201, 169, 97, 0.12);
    }

    .curve-elegant-3 {
      width: 400px;
      height: 750px;
      top: 25%;
      right: -50px;
      border: 2px solid rgba(201, 169, 97, 0.28);
      background: linear-gradient(135deg, 
        rgba(201, 169, 97, 0.10) 0%, 
        rgba(201, 169, 97, 0.05) 50%,
        transparent 90%);
      transform: rotate(45deg);
      animation: driftElegant 18s ease-in-out infinite;
      box-shadow: 
        inset 0 0 40px rgba(201, 169, 97, 0.07),
        0 0 60px rgba(201, 169, 97, 0.10);
    }

    .curve-elegant-4 {
      width: 450px;
      height: 850px;
      top: 50%;
      left: -100px;
      border: 2.5px solid rgba(201, 169, 97, 0.30);
      background: linear-gradient(135deg, 
        rgba(201, 169, 97, 0.11) 0%, 
        transparent 70%);
      transform: rotate(-35deg);
      animation: pulseElegant 20s ease-in-out infinite;
      box-shadow: 
        inset 0 0 45px rgba(201, 169, 97, 0.08),
        0 0 65px rgba(201, 169, 97, 0.11);
    }

    @keyframes floatElegant {
      0%, 100% { 
        transform: translateY(0) rotate(var(--base-rotation, 0deg));
        opacity: 1;
      }
      50% { 
        transform: translateY(-30px) rotate(calc(var(--base-rotation, 0deg) + 3deg));
        opacity: 0.85;
      }
    }

    @keyframes driftElegant {
      0%, 100% { 
        transform: translate(0, 0) rotate(45deg);
        opacity: 1;
      }
      33% { 
        transform: translate(20px, -25px) rotate(48deg);
        opacity: 0.9;
      }
      66% { 
        transform: translate(-10px, -15px) rotate(42deg);
        opacity: 0.95;
      }
    }

    @keyframes pulseElegant {
      0%, 100% { 
        transform: translate(0, 0) scale(1) rotate(-35deg);
        opacity: 1;
      }
      50% { 
        transform: translate(-15px, 10px) scale(1.05) rotate(-33deg);
        opacity: 0.9;
      }
    }

    .curve-elegant-1 { --base-rotation: 25deg; }
    .curve-elegant-2 { --base-rotation: -20deg; }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.01'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 1;
    }

    .container { 
      max-width: 900px; 
      margin: 0 auto; 
      position: relative;
      z-index: 2;
      padding: 0 1rem;
    }

    /* HEADER */
    .header { 
      text-align: center; 
      margin-bottom: 2.5rem;
      padding: 1.5rem 0 1rem;
    }

    .header h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2.25rem; 
      font-weight: 700; 
      color: #C9A961;
      margin-bottom: 0.5rem; 
      letter-spacing: -0.04em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header .subtitle { 
      font-size: 0.8125rem; 
      color: #8e8e93; 
      margin-bottom: 0.375rem;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .header .author { 
      font-size: 0.6875rem; 
      color: #636366; 
      font-weight: 400;
      letter-spacing: 0.02em;
    }

    /* GAME SELECTION SCREEN */
    .game-select-screen {
      display: none;
      padding: 2rem 1rem 3rem;
    }

    .game-select-screen.active {
      display: block;
    }

    .content-types {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      column-gap: 1.15rem;
      row-gap: 2.2rem;
      max-width: 400px;
      margin: 0 auto;
    }

    .content-type-card {
      aspect-ratio: 1.1;
      background: #000000;
      backdrop-filter: blur(40px) saturate(150%);
      -webkit-backdrop-filter: blur(40px) saturate(150%);
      border-radius: 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 2px 8px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(84, 84, 88, 0.25);
      width: 85%;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
      padding: 1rem;
    }

    .content-type-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(201, 169, 97, 0.1), transparent);
      transition: left 0.5s;
    }

    .content-type-card:hover::before {
      left: 100%;
    }

    .content-type-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 12px 40px rgba(201, 169, 97, 0.2),
                  0 0 0 1px rgba(201, 169, 97, 0.3),
                  0 4px 16px rgba(0, 0, 0, 0.3);
      border-color: rgba(201, 169, 97, 0.4);
    }

    .type-icon {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
    }

    .type-title {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: #8e8e93;
      text-align: center;
      line-height: 1.4;
      text-transform: uppercase;
    }

    /* GAME SCREEN */
    .game-screen {
      display: none;
      padding: 1rem;
    }

    .game-screen.active {
      display: block;
    }

    .game-container {
      background: rgba(28, 28, 30, 0.98);
      backdrop-filter: blur(60px) saturate(180%);
      -webkit-backdrop-filter: blur(60px) saturate(180%);
      border: 1px solid rgba(84, 84, 88, 0.4);
      border-radius: 1.5rem;
      padding: 1.75rem 1.25rem 2rem 1.25rem;
      max-width: 900px;
      margin: 0 auto;
      box-shadow: 0 25px 50px rgba(0,0,0,0.6), 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .game-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.125rem;
      font-weight: 600;
      color: #C9A961;
      text-align: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(84, 84, 88, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .game-instructions {
      background: rgba(201, 169, 97, 0.08);
      border-left: 3px solid #C9A961;
      padding: 0.875rem 1rem;
      margin-bottom: 1.5rem;
      border-radius: 0.5rem;
      font-size: 0.8125rem;
      color: #e5e5e7;
      line-height: 1.6;
    }

    /* SENTENCES DISPLAY */
    .sentences-display {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 1rem;
      border: 1px solid rgba(84, 84, 88, 0.3);
      padding: 1rem;
      margin-bottom: 1.5rem;
      max-height: 550px;
      overflow-y: auto;
    }

    .sentences-grid {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .sentence-card {
      background: rgba(28, 28, 30, 0.95);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 0.75rem;
      padding: 0.5rem 0.75rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .sentence-card:hover {
      border-color: rgba(201, 169, 97, 0.5);
      box-shadow: 0 4px 15px rgba(201, 169, 97, 0.15);
    }

    .sentence-card.has-number {
      background: rgba(201, 169, 97, 0.12);
      border-color: rgba(201, 169, 97, 0.4);
      box-shadow: 0 2px 8px rgba(201, 169, 97, 0.1);
    }

    .sentence-card.correct {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.15);
    }

    .sentence-card.incorrect {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.15);
    }

    .sentence-label {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.7rem;
      font-weight: 700;
      color: #C9A961;
      background: rgba(201, 169, 97, 0.15);
      padding: 0.25rem 0.4rem;
      border-radius: 0.3rem;
      text-align: center;
      min-width: 35px;
      flex-shrink: 0;
    }

    .sentence-content {
      flex: 1;
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .sentence-text-display {
      flex: 1;
      font-family: 'Crimson Text', serif;
      font-size: 0.93rem;
      line-height: 1.4;
      color: #e5e5e7;
      font-weight: 500;
    }

    /* Linking words highlighted in blue */
    .linking-word {
      color: #3b82f6;
      font-weight: 600;
    }

    .sentence-input {
      flex-shrink: 0;
    }

    .sentence-input input {
      width: 50px;
      padding: 0.35rem;
      text-align: center;
      font-size: 0.95rem;
      font-weight: 700;
      border: 1px solid rgba(84, 84, 88, 0.4);
      border-radius: 0.5rem;
      background: rgba(0, 0, 0, 0.5);
      color: #e5e5e7;
      transition: all 0.3s;
    }

    .sentence-input input:focus {
      outline: none;
      border-color: #C9A961;
      box-shadow: 0 0 0 3px rgba(201, 169, 97, 0.2);
      background: rgba(0, 0, 0, 0.7);
    }

    .sentence-input label {
      display: block;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.6rem;
      font-weight: 600;
      color: #8e8e93;
      margin-bottom: 0.15rem;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    /* ACTION BUTTONS */
    .game-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .game-btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.8125rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.875rem 2rem;
      border: none;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .btn-submit {
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.85) 100%);
      color: #0d0d0d;
    }

    .btn-submit:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(201, 169, 97, 0.4);
    }

    .btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-retry {
      background: rgba(28, 28, 30, 0.8);
      border: 1px solid rgba(84, 84, 88, 0.4);
      color: #e5e5e7;
    }

    .btn-retry:hover {
      transform: translateY(-2px);
      border-color: rgba(201, 169, 97, 0.4);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }

    .btn-new {
      background: rgba(28, 28, 30, 0.8);
      border: 1px solid rgba(84, 84, 88, 0.4);
      color: #8e8e93;
    }

    .btn-new:hover {
      transform: translateY(-2px);
      border-color: rgba(84, 84, 88, 0.6);
      color: #e5e5e7;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }

    /* RESULTS */
    .results-display {
      display: none;
      background: rgba(201, 169, 97, 0.1);
      border: 1px solid rgba(201, 169, 97, 0.4);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .results-display.show {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .results-score {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2.5rem;
      font-weight: 800;
      color: #C9A961;
      margin-bottom: 0.5rem;
    }

    .results-message {
      font-size: 1rem;
      color: #e5e5e7;
      margin-bottom: 0.5rem;
    }

    .perfect-score {
      color: #22c55e;
    }

    /* Scrollbar */
    .sentences-display::-webkit-scrollbar { width: 6px; }
    .sentences-display::-webkit-scrollbar-track { background: transparent; }
    .sentences-display::-webkit-scrollbar-thumb {
      background: rgba(99, 99, 102, 0.3);
      border-radius: 6px;
      transition: background 0.2s ease;
    }
    .sentences-display::-webkit-scrollbar-thumb:hover { 
      background: rgba(99, 99, 102, 0.5); 
    }

    /* MOBILE */
    @media (max-width: 768px) {
      .content-types {
        grid-template-columns: repeat(2, 1fr);
        column-gap: 1.25rem;
        row-gap: 1.925rem;
      }

      .content-type-card {
        width: 77%;
      }

      .sentence-text-display {
        font-size: 0.88rem;
      }

      .sentence-input input {
        width: 45px;
        padding: 0.3rem;
        font-size: 0.9rem;
      }

      .sentence-card {
        padding: 0.45rem 0.65rem;
        flex-direction: column;
        gap: 0.5rem;
      }

      .sentence-content {
        flex-direction: column;
        gap: 0.5rem;
        width: 100%;
      }

      .sentence-input {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        align-self: flex-end;
      }

      .sentence-input label {
        margin-bottom: 0;
      }
    }

    @media (max-width: 480px) {
      .content-type-card {
        width: 71%;
      }

      .type-title {
        font-size: 0.65rem;
      }
    }
  </style>
</head>
<body>
  <div class="background">
    <div class="elegant-curves">
      <div class="curve-elegant curve-elegant-1"></div>
      <div class="curve-elegant curve-elegant-2"></div>
      <div class="curve-elegant curve-elegant-3"></div>
      <div class="curve-elegant curve-elegant-4"></div>
    </div>
  </div>

  <div class="container">
    
    <!-- HEADER -->
    <header class="header">
      <h1>INTUITY</h1>
      <p class="subtitle">Sentence Sequencing Challenge</p>
      <p class="author">Majid Nashtai</p>
    </header>

    <!-- GAME SELECTION SCREEN -->
    <div class="game-select-screen active" id="selectScreen">
      <div class="content-types">
        <div class="content-type-card" onclick="startGame('essays')">
          <div class="type-icon">üìù</div>
          <div class="type-title">Essays</div>
        </div>

        <div class="content-type-card" onclick="startGame('reports')">
          <div class="type-icon">üìä</div>
          <div class="type-title">Reports</div>
        </div>

        <div class="content-type-card" onclick="startGame('reviews')">
          <div class="type-icon">‚≠ê</div>
          <div class="type-title">Reviews</div>
        </div>

        <div class="content-type-card" onclick="startGame('emails')">
          <div class="type-icon">üìß</div>
          <div class="type-title">Emails</div>
        </div>
      </div>
    </div>

    <!-- GAME SCREEN -->
    <div class="game-screen" id="gameScreen">
      <div class="game-container">
        <h2 class="game-title" id="gameTitle">Sentence Sequencing Challenge</h2>
        
        <div class="game-instructions">
          <strong>üìã Instructions:</strong> Read through ALL the scrambled sentences below. 
          Analyze the discourse markers, transitions, and logical flow. 
          Then enter the correct order number (1, 2, 3...) in the box next to each sentence. 
          Sentences will automatically reorder as you assign numbers!
        </div>

        <!-- SENTENCE LIST DISPLAY -->
        <div class="sentences-display">
          <div class="sentences-grid" id="sentencesGrid">
            <!-- All sentences shown here -->
          </div>
        </div>

        <!-- RESULTS -->
        <div class="results-display" id="resultsDisplay">
          <div class="results-score" id="resultsScore">0%</div>
          <div class="results-message" id="resultsMessage">Keep trying!</div>
        </div>

        <!-- ACTIONS -->
        <div class="game-actions">
          <button class="game-btn btn-submit" id="submitBtn" onclick="checkAnswer()">Submit Answer</button>
          <button class="game-btn btn-retry" id="retryBtn" onclick="retry()" style="display:none;">Try Again</button>
          <button class="game-btn btn-new" onclick="newGame()">New Challenge</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    let currentType = null;
    let currentData = null;
    let currentSample = null;
    let sentences = [];
    let scrambledSentences = [];
    let correctOrder = [];
    let hasSubmitted = false;
    let userPositions = {}; // Track user-assigned positions

    const DATA_PATHS = {
      essays: 'data/essays-models.json',
      reports: 'data/reports-models.json',
      reviews: 'data/reviews-models.json',
      emails: 'data/emails-models.json'
    };

    // Common linking words to highlight
    const LINKING_WORDS = [
      'however', 'therefore', 'moreover', 'furthermore', 'additionally', 'consequently',
      'meanwhile', 'nevertheless', 'nonetheless', 'thus', 'hence', 'accordingly',
      'besides', 'likewise', 'similarly', 'conversely', 'alternatively', 'specifically',
      'indeed', 'furthermore', 'meanwhile', 'subsequently', 'finally', 'firstly',
      'secondly', 'thirdly', 'lastly', 'in addition', 'in contrast', 'for example',
      'for instance', 'as a result', 'on the other hand', 'in conclusion', 'to sum up',
      'in summary', 'in brief', 'in short', 'overall', 'essentially', 'basically'
    ];

    // Start game with selected type
    async function startGame(type) {
      currentType = type;
      
      try {
        const response = await fetch(DATA_PATHS[type]);
        if (!response.ok) throw new Error(`Failed to load ${type}`);
        
        currentData = await response.json();
        
        // Pick random sample
        const randomIndex = Math.floor(Math.random() * currentData.samples.length);
        currentSample = currentData.samples[randomIndex];
        
        // Extract and split sentences
        extractSentences();
        
        // Show game screen
        document.getElementById('selectScreen').classList.remove('active');
        document.getElementById('gameScreen').classList.add('active');
        
        // Update title
        document.getElementById('gameTitle').textContent = currentSample.topic || 'Sentence Sequencing Challenge';
        
        // Render game
        renderGame();
        
      } catch (error) {
        console.error('Error loading game:', error);
        alert('Failed to load game data. Please try again.');
      }
    }

    // Extract sentences from paragraphs
    function extractSentences() {
      sentences = [];
      correctOrder = [];
      
      currentSample.paragraphs.forEach(para => {
        // Split by sentence endings (. ! ?)
        const paraSentences = para.text
          .split(/(?<=[.!?])\s+/)
          .filter(s => s.trim().length > 0)
          .map(s => s.trim());
        
        sentences.push(...paraSentences);
      });
      
      // Store correct order (0-indexed)
      correctOrder = sentences.map((_, i) => i);
      
      // Create scrambled version
      scrambledSentences = [...sentences];
      shuffleArray(scrambledSentences);
      
      console.log('Total sentences:', sentences.length);
      console.log('Scrambled:', scrambledSentences.length);
    }

    // Shuffle array (Fisher-Yates)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Highlight linking words in sentence text
    function highlightLinkingWords(text) {
      let highlightedText = text;
      
      LINKING_WORDS.forEach(word => {
        const regex = new RegExp(`\\b(${word})\\b`, 'gi');
        highlightedText = highlightedText.replace(regex, '<span class="linking-word">$1</span>');
      });
      
      return highlightedText;
    }

    // Render game interface
    function renderGame() {
      hasSubmitted = false;
      userPositions = {};
      
      // Reset UI
      document.getElementById('resultsDisplay').classList.remove('show');
      document.getElementById('submitBtn').style.display = 'inline-block';
      document.getElementById('retryBtn').style.display = 'none';
      
      // Render all sentences
      renderSentences();
    }

    // Render all sentence cards in order
    function renderSentences() {
      const container = document.getElementById('sentencesGrid');
      container.innerHTML = '';
      
      // Create array of sentence objects with their positions
      const sentenceObjects = scrambledSentences.map((sentence, originalIndex) => ({
        sentence,
        originalIndex,
        position: userPositions[originalIndex] || null
      }));
      
      // Create position slots (1 to max sentence count)
      const positionSlots = new Array(scrambledSentences.length).fill(null);
      const unpositioned = [];
      
      // Fill position slots with sentences that have assigned positions
      sentenceObjects.forEach(obj => {
        if (obj.position !== null && obj.position >= 1 && obj.position <= scrambledSentences.length) {
          positionSlots[obj.position - 1] = obj;
        } else {
          unpositioned.push(obj);
        }
      });
      
      // Fill remaining slots with unpositioned sentences
      let unpositionedIndex = 0;
      for (let i = 0; i < positionSlots.length; i++) {
        if (positionSlots[i] === null && unpositionedIndex < unpositioned.length) {
          positionSlots[i] = unpositioned[unpositionedIndex++];
        }
      }
      
      // Render in order
      positionSlots.forEach((obj, displayPosition) => {
        if (!obj) return;
        
        const { sentence, originalIndex, position } = obj;
        
        const card = document.createElement('div');
        card.className = 'sentence-card';
        if (position !== null) {
          card.classList.add('has-number');
        }
        card.id = `card-${originalIndex}`;
        
        const highlightedText = highlightLinkingWords(sentence);
        
        card.innerHTML = `
          <div class="sentence-label">S${originalIndex + 1}</div>
          <div class="sentence-content">
            <div class="sentence-text-display">${highlightedText}</div>
            <div class="sentence-input">
              <label>Order</label>
              <input type="number" 
                     id="input-${originalIndex}" 
                     min="1" 
                     max="${scrambledSentences.length}"
                     value="${position || ''}"
                     placeholder="#"
                     onblur="updatePosition(${originalIndex})"
                     onkeypress="if(event.key === 'Enter') { this.blur(); }">
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
    }

    // Update position when user finishes entering number (blur or Enter)
    function updatePosition(originalIndex) {
      const input = document.getElementById(`input-${originalIndex}`);
      const value = parseInt(input.value);
      
      // Only update if valid number
      if (value && value >= 1 && value <= scrambledSentences.length) {
        userPositions[originalIndex] = value;
        // Re-render to show new order
        renderSentences();
      } else if (input.value === '') {
        // User cleared the input
        delete userPositions[originalIndex];
        renderSentences();
      }
    }

    // Check answer
    function checkAnswer() {
      if (hasSubmitted) return;
      
      const userAnswers = [];
      let allFilled = true;
      
      // Collect answers
      scrambledSentences.forEach((_, index) => {
        const value = userPositions[index] || 0;
        
        if (!value || value < 1 || value > scrambledSentences.length) {
          allFilled = false;
        }
        
        userAnswers.push(value);
      });
      
      if (!allFilled) {
        alert('Please fill in all boxes with numbers from 1 to ' + scrambledSentences.length);
        return;
      }
      
      // Check for duplicates
      const uniqueAnswers = new Set(userAnswers);
      if (uniqueAnswers.size !== userAnswers.length) {
        alert('Each number can only be used once! Please check for duplicates.');
        return;
      }
      
      hasSubmitted = true;
      
      // Calculate score
      let correctCount = 0;
      
      scrambledSentences.forEach((scrambledSentence, scrambledIndex) => {
        const userPosition = userAnswers[scrambledIndex];
        const correctPosition = sentences.indexOf(scrambledSentence) + 1; // 1-indexed
        
        const card = document.getElementById(`card-${scrambledIndex}`);
        
        if (userPosition === correctPosition) {
          correctCount++;
          card.classList.add('correct');
          card.classList.remove('incorrect');
        } else {
          card.classList.add('incorrect');
          card.classList.remove('correct');
        }
      });
      
      const percentage = Math.round((correctCount / scrambledSentences.length) * 100);
      
      // Show results
      showResults(percentage, correctCount);
    }

    function showResults(percentage, correctCount) {
      const resultsDiv = document.getElementById('resultsDisplay');
      const scoreEl = document.getElementById('resultsScore');
      const messageEl = document.getElementById('resultsMessage');
      
      scoreEl.textContent = `${percentage}%`;
      
      if (percentage === 100) {
        scoreEl.className = 'results-score perfect-score';
        messageEl.textContent = 'üéâ Perfect! You mastered this text structure!';
      } else if (percentage >= 80) {
        scoreEl.className = 'results-score';
        messageEl.textContent = `Great job! You got ${correctCount} out of ${scrambledSentences.length} correct!`;
      } else if (percentage >= 60) {
        scoreEl.className = 'results-score';
        messageEl.textContent = `Good effort! You got ${correctCount} out of ${scrambledSentences.length} correct. Try again!`;
      } else {
        scoreEl.className = 'results-score';
        messageEl.textContent = `You got ${correctCount} out of ${scrambledSentences.length} correct. Keep practicing!`;
      }
      
      resultsDiv.classList.add('show');
      document.getElementById('submitBtn').style.display = 'none';
      document.getElementById('retryBtn').style.display = 'inline-block';
    }

    function retry() {
      hasSubmitted = false;
      userPositions = {};
      
      // Re-render without positions
      renderSentences();
      
      // Clear feedback classes
      scrambledSentences.forEach((_, index) => {
        const card = document.getElementById(`card-${index}`);
        if (card) {
          card.classList.remove('correct', 'incorrect');
        }
      });
      
      // Hide results
      document.getElementById('resultsDisplay').classList.remove('show');
      document.getElementById('submitBtn').style.display = 'inline-block';
      document.getElementById('retryBtn').style.display = 'none';
    }

    function newGame() {
      document.getElementById('gameScreen').classList.remove('active');
      document.getElementById('selectScreen').classList.add('active');
    }
  </script>
</body>
</html>
