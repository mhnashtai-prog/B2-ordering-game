<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INTUITY GAMES - Sentence Sequencing</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800;900&family=DM+Sans:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0d0d0d;
      background-image: radial-gradient(circle at 20% 50%, rgba(201, 169, 97, 0.04) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(201, 169, 97, 0.03) 0%, transparent 50%);
      color: #e5e5e7;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .container {
      max-width: 75rem;
      margin: 0 auto;
      padding: 1rem;
    }

    /* HEADER */
    .game-header {
      background: rgba(28, 28, 30, 0.95);
      backdrop-filter: blur(40px);
      border-bottom: 1px solid rgba(84, 84, 88, 0.3);
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .brand {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
    }
    
    .brand-logo {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.6rem;
      font-weight: 800;
      background: linear-gradient(135deg, #C9A961 0%, #FFD700 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
      letter-spacing: -0.04em;
    }
    
    .brand-subtitle {
      font-size: 0.75rem;
      color: #C9A961;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .score-display {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      color: #C9A961;
    }

    .crown-icon {
      font-size: 2rem;
      opacity: 0;
      transition: all 0.5s;
      transform: scale(0.5);
    }

    .crown-icon.show {
      opacity: 1;
      transform: scale(1);
      animation: crownBounce 0.6s ease-out;
    }

    @keyframes crownBounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }

    /* GAME SELECTION */
    .game-select-screen {
      display: none;
      text-align: center;
      padding: 4rem 2rem;
    }

    .game-select-screen.active {
      display: block;
    }

    .select-title {
      font-family: 'Crimson Text', serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: #e5e5e7;
      margin-bottom: 1rem;
    }

    .select-subtitle {
      font-size: 1.1rem;
      color: #9ca3af;
      margin-bottom: 3rem;
    }

    .content-types {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      max-width: 60rem;
      margin: 0 auto;
    }

    .content-type-card {
      background: rgba(28, 28, 30, 0.9);
      border: 2px solid rgba(201, 169, 97, 0.3);
      border-radius: 1rem;
      padding: 2rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .content-type-card:hover {
      transform: translateY(-8px);
      border-color: rgba(201, 169, 97, 0.6);
      box-shadow: 0 12px 40px rgba(201, 169, 97, 0.3);
    }

    .type-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .type-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .type-description {
      font-size: 0.9rem;
      color: #9ca3af;
      line-height: 1.5;
    }

    /* GAME SCREEN */
    .game-screen {
      display: none;
    }

    .game-screen.active {
      display: block;
    }

    .game-container {
      background: linear-gradient(135deg, #f5f1e8 0%, #ede8dc 100%);
      border-radius: 2rem;
      padding: 2rem;
      max-width: 70rem;
      margin: 0 auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    }

    .game-title {
      font-family: 'Crimson Text', serif;
      font-size: 1.8rem;
      font-weight: 700;
      color: #1a1a1a;
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid rgba(0, 0, 0, 0.1);
    }

    .game-instructions {
      background: rgba(201, 169, 97, 0.1);
      border-left: 4px solid #C9A961;
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      border-radius: 0.5rem;
      font-size: 0.95rem;
      color: #2a2a2a;
      line-height: 1.6;
    }

    /* SENTENCES DISPLAY */
    .sentences-display {
      background: linear-gradient(145deg, rgba(28, 28, 30, 0.98), rgba(20, 20, 22, 0.98));
      border-radius: 1.5rem;
      border: 2px solid rgba(201, 169, 97, 0.3);
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
      margin-bottom: 2rem;
      max-height: 550px;
      overflow-y: auto;
    }

    .sentences-grid {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .sentence-card {
      background: rgba(245, 241, 232, 0.95);
      border: 2px solid rgba(139, 115, 85, 0.2);
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      transition: all 0.3s;
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .sentence-card:hover {
      border-color: rgba(201, 169, 97, 0.5);
      box-shadow: 0 4px 15px rgba(201, 169, 97, 0.2);
    }

    .sentence-card.has-number {
      background: linear-gradient(135deg, rgba(255, 243, 205, 0.95), rgba(255, 250, 230, 0.95));
      border-color: rgba(201, 169, 97, 0.6);
      box-shadow: 0 2px 8px rgba(201, 169, 97, 0.15);
    }

    .sentence-card.correct {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.1);
    }

    .sentence-card.incorrect {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }

    .sentence-label {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.7rem;
      font-weight: 700;
      color: #C9A961;
      background: rgba(201, 169, 97, 0.15);
      padding: 0.25rem 0.4rem;
      border-radius: 0.3rem;
      text-align: center;
      min-width: 35px;
      flex-shrink: 0;
    }

    .sentence-content {
      flex: 1;
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .sentence-text-display {
      flex: 1;
      font-family: 'Crimson Text', serif;
      font-size: 0.93rem;
      line-height: 1.4;
      color: #2a2a2a;
      font-weight: 500;
    }

    /* Linking words highlighted in blue */
    .linking-word {
      color: #3b82f6;
      font-weight: 600;
    }

    .sentence-input {
      flex-shrink: 0;
    }

    .sentence-input input {
      width: 50px;
      padding: 0.35rem;
      text-align: center;
      font-size: 0.95rem;
      font-weight: 700;
      border: 2px solid rgba(139, 115, 85, 0.3);
      border-radius: 0.35rem;
      background: white;
      color: #2a2a2a;
      transition: all 0.3s;
    }

    .sentence-input input:focus {
      outline: none;
      border-color: #C9A961;
      box-shadow: 0 0 0 3px rgba(201, 169, 97, 0.2);
    }

    .sentence-input label {
      display: block;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.6rem;
      font-weight: 600;
      color: #6b5843;
      margin-bottom: 0.15rem;
      text-align: center;
    }

    /* ACTION BUTTONS */
    .game-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .game-btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.9rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.9rem 2.5rem;
      border: none;
      border-radius: 2rem;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-submit {
      background: linear-gradient(135deg, #c9a961 0%, #FFD700 100%);
      color: #1a1410;
    }

    .btn-submit:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(201, 169, 97, 0.4);
    }

    .btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-retry {
      background: linear-gradient(135deg, #6b5843 0%, #8b7355 100%);
      color: #f5f1e8;
    }

    .btn-retry:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(107, 88, 67, 0.4);
    }

    .btn-new {
      background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
      color: #e5e5e7;
    }

    .btn-new:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(74, 85, 104, 0.4);
    }

    /* RESULTS */
    .results-display {
      display: none;
      background: rgba(201, 169, 97, 0.1);
      border: 2px solid #C9A961;
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .results-display.show {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .results-score {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 3rem;
      font-weight: 800;
      color: #2a2a2a;
      margin-bottom: 0.5rem;
    }

    .results-message {
      font-size: 1.2rem;
      color: #4a4a4a;
      margin-bottom: 1rem;
    }

    .perfect-score {
      color: #22c55e;
    }

    /* MOBILE */
    @media (max-width: 768px) {
      .sentence-text-display {
        font-size: 0.88rem;
      }

      .sentence-input input {
        width: 45px;
        padding: 0.3rem;
        font-size: 0.9rem;
      }

      .sentence-card {
        padding: 0.45rem 0.65rem;
        flex-direction: column;
        gap: 0.5rem;
      }

      .sentence-content {
        flex-direction: column;
        gap: 0.5rem;
      }

      .sentence-input {
        display: flex;
        align-items: center;
        gap: 0.4rem;
      }

      .sentence-input label {
        margin-bottom: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- HEADER -->
    <header class="game-header">
      <div class="header-content">
        <div class="brand">
          <span class="brand-logo">INTUITY GAMES</span>
          <span class="brand-subtitle">Sentence Sequencing</span>
        </div>
        <div class="score-display">
          <span id="scoreText">Score: -</span>
          <span class="crown-icon" id="crownIcon">üëë</span>
        </div>
      </div>
    </header>

    <!-- GAME SELECTION SCREEN -->
    <div class="game-select-screen active" id="selectScreen">
      <h1 class="select-title">Choose Your Challenge</h1>
      <p class="select-subtitle">Select a writing type to practice sentence ordering</p>
      
      <div class="content-types">
        <div class="content-type-card" onclick="startGame('essays')">
          <div class="type-icon">üìù</div>
          <div class="type-title">Essays</div>
          <div class="type-description">Practice ordering argumentative and opinion essays</div>
        </div>

        <div class="content-type-card" onclick="startGame('reports')">
          <div class="type-icon">üìä</div>
          <div class="type-title">Reports</div>
          <div class="type-description">Master formal report structure and flow</div>
        </div>

        <div class="content-type-card" onclick="startGame('reviews')">
          <div class="type-icon">‚≠ê</div>
          <div class="type-title">Reviews</div>
          <div class="type-description">Learn product review organization</div>
        </div>

        <div class="content-type-card" onclick="startGame('emails')">
          <div class="type-icon">üìß</div>
          <div class="type-title">Emails</div>
          <div class="type-description">Perfect formal and informal email structure</div>
        </div>
      </div>
    </div>

    <!-- GAME SCREEN -->
    <div class="game-screen" id="gameScreen">
      <div class="game-container">
        <h2 class="game-title" id="gameTitle">Sentence Sequencing Challenge</h2>
        
        <div class="game-instructions">
          <strong>üìã Instructions:</strong> Read through ALL the scrambled sentences below. 
          Analyze the discourse markers, transitions, and logical flow. 
          Then enter the correct order number (1, 2, 3...) in the box next to each sentence. 
          Sentences will automatically reorder as you assign numbers!
        </div>

        <!-- SENTENCE LIST DISPLAY -->
        <div class="sentences-display">
          <div class="sentences-grid" id="sentencesGrid">
            <!-- All sentences shown here -->
          </div>
        </div>

        <!-- RESULTS -->
        <div class="results-display" id="resultsDisplay">
          <div class="results-score" id="resultsScore">0%</div>
          <div class="results-message" id="resultsMessage">Keep trying!</div>
        </div>

        <!-- ACTIONS -->
        <div class="game-actions">
          <button class="game-btn btn-submit" id="submitBtn" onclick="checkAnswer()">Submit Answer</button>
          <button class="game-btn btn-retry" id="retryBtn" onclick="retry()" style="display:none;">Try Again</button>
          <button class="game-btn btn-new" onclick="newGame()">New Challenge</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    let currentType = null;
    let currentData = null;
    let currentSample = null;
    let sentences = [];
    let scrambledSentences = [];
    let correctOrder = [];
    let hasSubmitted = false;
    let userPositions = {}; // Track user-assigned positions

    const DATA_PATHS = {
      essays: 'data/essays-models.json',
      reports: 'data/reports-models.json',
      reviews: 'data/reviews-models.json',
      emails: 'data/emails-models.json'
    };

    // Common linking words to highlight
    const LINKING_WORDS = [
      'however', 'therefore', 'moreover', 'furthermore', 'additionally', 'consequently',
      'meanwhile', 'nevertheless', 'nonetheless', 'thus', 'hence', 'accordingly',
      'besides', 'likewise', 'similarly', 'conversely', 'alternatively', 'specifically',
      'indeed', 'furthermore', 'meanwhile', 'subsequently', 'finally', 'firstly',
      'secondly', 'thirdly', 'lastly', 'in addition', 'in contrast', 'for example',
      'for instance', 'as a result', 'on the other hand', 'in conclusion', 'to sum up',
      'in summary', 'in brief', 'in short', 'overall', 'essentially', 'basically'
    ];

    // Start game with selected type
    async function startGame(type) {
      currentType = type;
      
      try {
        const response = await fetch(DATA_PATHS[type]);
        if (!response.ok) throw new Error(`Failed to load ${type}`);
        
        currentData = await response.json();
        
        // Pick random sample
        const randomIndex = Math.floor(Math.random() * currentData.samples.length);
        currentSample = currentData.samples[randomIndex];
        
        // Extract and split sentences
        extractSentences();
        
        // Show game screen
        document.getElementById('selectScreen').classList.remove('active');
        document.getElementById('gameScreen').classList.add('active');
        
        // Update title
        document.getElementById('gameTitle').textContent = currentSample.topic || 'Sentence Sequencing Challenge';
        
        // Render game
        renderGame();
        
      } catch (error) {
        console.error('Error loading game:', error);
        alert('Failed to load game data. Please try again.');
      }
    }

    // Extract sentences from paragraphs
    function extractSentences() {
      sentences = [];
      correctOrder = [];
      
      currentSample.paragraphs.forEach(para => {
        // Split by sentence endings (. ! ?)
        const paraSentences = para.text
          .split(/(?<=[.!?])\s+/)
          .filter(s => s.trim().length > 0)
          .map(s => s.trim());
        
        sentences.push(...paraSentences);
      });
      
      // Store correct order (0-indexed)
      correctOrder = sentences.map((_, i) => i);
      
      // Create scrambled version
      scrambledSentences = [...sentences];
      shuffleArray(scrambledSentences);
      
      console.log('Total sentences:', sentences.length);
      console.log('Scrambled:', scrambledSentences.length);
    }

    // Shuffle array (Fisher-Yates)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Highlight linking words in sentence text
    function highlightLinkingWords(text) {
      let highlightedText = text;
      
      LINKING_WORDS.forEach(word => {
        const regex = new RegExp(`\\b(${word})\\b`, 'gi');
        highlightedText = highlightedText.replace(regex, '<span class="linking-word">$1</span>');
      });
      
      return highlightedText;
    }

    // Render game interface
    function renderGame() {
      hasSubmitted = false;
      userPositions = {};
      
      // Reset UI
      document.getElementById('resultsDisplay').classList.remove('show');
      document.getElementById('submitBtn').style.display = 'inline-block';
      document.getElementById('retryBtn').style.display = 'none';
      document.getElementById('crownIcon').classList.remove('show');
      document.getElementById('scoreText').textContent = 'Score: -';
      
      // Render all sentences
      renderSentences();
    }

    // Render all sentence cards in order
    function renderSentences() {
      const container = document.getElementById('sentencesGrid');
      container.innerHTML = '';
      
      // Create array of sentence objects with their positions
      const sentenceObjects = scrambledSentences.map((sentence, originalIndex) => ({
        sentence,
        originalIndex,
        position: userPositions[originalIndex] || null
      }));
      
      // Create position slots (1 to max sentence count)
      const positionSlots = new Array(scrambledSentences.length).fill(null);
      const unpositioned = [];
      
      // Fill position slots with sentences that have assigned positions
      sentenceObjects.forEach(obj => {
        if (obj.position !== null && obj.position >= 1 && obj.position <= scrambledSentences.length) {
          positionSlots[obj.position - 1] = obj;
        } else {
          unpositioned.push(obj);
        }
      });
      
      // Fill remaining slots with unpositioned sentences
      let unpositionedIndex = 0;
      for (let i = 0; i < positionSlots.length; i++) {
        if (positionSlots[i] === null && unpositionedIndex < unpositioned.length) {
          positionSlots[i] = unpositioned[unpositionedIndex++];
        }
      }
      
      // Render in order
      positionSlots.forEach((obj, displayPosition) => {
        if (!obj) return;
        
        const { sentence, originalIndex, position } = obj;
        
        const card = document.createElement('div');
        card.className = 'sentence-card';
        if (position !== null) {
          card.classList.add('has-number');
        }
        card.id = `card-${originalIndex}`;
        
        const highlightedText = highlightLinkingWords(sentence);
        
        card.innerHTML = `
          <div class="sentence-label">S${originalIndex + 1}</div>
          <div class="sentence-content">
            <div class="sentence-text-display">${highlightedText}</div>
            <div class="sentence-input">
              <label>Order</label>
              <input type="number" 
                     id="input-${originalIndex}" 
                     min="1" 
                     max="${scrambledSentences.length}"
                     value="${position || ''}"
                     placeholder="#"
                     onblur="updatePosition(${originalIndex})"
                     onkeypress="if(event.key === 'Enter') { this.blur(); }">
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
    }

    // Update position when user finishes entering number (blur or Enter)
    function updatePosition(originalIndex) {
      const input = document.getElementById(`input-${originalIndex}`);
      const value = parseInt(input.value);
      
      // Only update if valid number
      if (value && value >= 1 && value <= scrambledSentences.length) {
        userPositions[originalIndex] = value;
        // Re-render to show new order
        renderSentences();
      } else if (input.value === '') {
        // User cleared the input
        delete userPositions[originalIndex];
        renderSentences();
      }
    }

    // Check answer
    function checkAnswer() {
      if (hasSubmitted) return;
      
      const userAnswers = [];
      let allFilled = true;
      
      // Collect answers
      scrambledSentences.forEach((_, index) => {
        const value = userPositions[index] || 0;
        
        if (!value || value < 1 || value > scrambledSentences.length) {
          allFilled = false;
        }
        
        userAnswers.push(value);
      });
      
      if (!allFilled) {
        alert('Please fill in all boxes with numbers from 1 to ' + scrambledSentences.length);
        return;
      }
      
      // Check for duplicates
      const uniqueAnswers = new Set(userAnswers);
      if (uniqueAnswers.size !== userAnswers.length) {
        alert('Each number can only be used once! Please check for duplicates.');
        return;
      }
      
      hasSubmitted = true;
      
      // Calculate score
      let correctCount = 0;
      
      scrambledSentences.forEach((scrambledSentence, scrambledIndex) => {
        const userPosition = userAnswers[scrambledIndex];
        const correctPosition = sentences.indexOf(scrambledSentence) + 1; // 1-indexed
        
        const card = document.getElementById(`card-${scrambledIndex}`);
        
        if (userPosition === correctPosition) {
          correctCount++;
          card.classList.add('correct');
          card.classList.remove('incorrect');
        } else {
          card.classList.add('incorrect');
          card.classList.remove('correct');
        }
      });
      
      const percentage = Math.round((correctCount / scrambledSentences.length) * 100);
      
      // Show results
      showResults(percentage, correctCount);
    }

    function showResults(percentage, correctCount) {
      const resultsDiv = document.getElementById('resultsDisplay');
      const scoreEl = document.getElementById('resultsScore');
      const messageEl = document.getElementById('resultsMessage');
      const crownIcon = document.getElementById('crownIcon');
      
      scoreEl.textContent = `${percentage}%`;
      
      if (percentage === 100) {
        scoreEl.className = 'results-score perfect-score';
        messageEl.textContent = 'üéâ Perfect! You mastered this text structure!';
        crownIcon.classList.add('show');
      } else if (percentage >= 80) {
        scoreEl.className = 'results-score';
        messageEl.textContent = `Great job! You got ${correctCount} out of ${scrambledSentences.length} correct!`;
      } else if (percentage >= 60) {
        scoreEl.className = 'results-score';
        messageEl.textContent = `Good effort! You got ${correctCount} out of ${scrambledSentences.length} correct. Try again!`;
      } else {
        scoreEl.className = 'results-score';
        messageEl.textContent = `You got ${correctCount} out of ${scrambledSentences.length} correct. Keep practicing!`;
      }
      
      resultsDiv.classList.add('show');
      document.getElementById('scoreText').textContent = `Score: ${percentage}%`;
      document.getElementById('submitBtn').style.display = 'none';
      document.getElementById('retryBtn').style.display = 'inline-block';
    }

    function retry() {
      hasSubmitted = false;
      userPositions = {};
      
      // Re-render without positions
      renderSentences();
      
      // Clear feedback classes
      scrambledSentences.forEach((_, index) => {
        const card = document.getElementById(`card-${index}`);
        if (card) {
          card.classList.remove('correct', 'incorrect');
        }
      });
      
      // Hide results
      document.getElementById('resultsDisplay').classList.remove('show');
      document.getElementById('submitBtn').style.display = 'inline-block';
      document.getElementById('retryBtn').style.display = 'none';
      document.getElementById('crownIcon').classList.remove('show');
    }

    function newGame() {
      document.getElementById('gameScreen').classList.remove('active');
      document.getElementById('selectScreen').classList.add('active');
    }
  </script>
</body>
</html>
